## 2025년 10월 27일 개발 로그 (2차)

### 주요 변경 사항: 시뮬레이션 고도화 및 현실성 강화

- **동시다발적 지역 봉쇄 시스템 도입:**
  - 기존에 단일 지역만 봉쇄 가능했던 로직을 개선하여, **여러 감염 밀집 지역을 동시에 봉쇄**할 수 있도록 변경했습니다.
  - `MAX_SIMULTANEOUS_LOCKDOWNS` 파라미터를 설정 파일에 추가하여, 시나리오별로 동시 봉쇄 가능 지역 수를 다르게 설정할 수 있습니다. (예: 중국 4곳, 외 대부분 2곳)
  - '봉쇄는 단 한 번만'이라는 기존 제한을 제거하여, 필요시 지속적으로 추가 봉쇄가 가능해졌습니다.

- **국가별 정책 현실성 강화:**
  - **중국 시나리오 특수 규칙:**
    - **초기 봉쇄 지연:** 시뮬레이션 초반(12세대 이전)의 자유로운 인구 이동을 보장하기 위해, 중국의 지역 봉쇄는 12세대 이후부터 발동되도록 수정했습니다.
    - **초기 이동 허용:** 12세대 이전에는 방역 단계가 격상되어도 항공편 이동이 금지되거나 감소하지 않는 특별 규칙을 추가했습니다.
  - **항공편 금지 정책 차등 적용:**
    - 웹 검색 결과를 바탕으로, 국가별 실제 방역 정책의 강도를 반영하여 항공편이 금지되는 방역 단계를 차등 적용했습니다. (`TRAVEL_BAN_ALERT_LEVEL` 파라미터 추가)
    - (예: 중국/이탈리아 3단계, 미국/영국 5단계, 스웨덴 금지 없음)
  - **항공편 이동률 현실화:**
    - 실제 국가별 일일 항공 이용객 데이터를 조사하여, 기존에 과도하게 높았던 `INTERNAL_TRAVEL_RATE`를 현실적인 수치(예: 선진국 0.6%, 개발도상국 0.2%)로 대폭 하향 조정했습니다.

---

## 2025년 10월 27일 개발 로그

### 주요 변경 사항

- **시뮬레이션 엔진 성능 최적화 (NumPy 도입):**
  - 순수 Python 루프를 사용하던 기존 로직을 NumPy 배열 연산 기반으로 전면 리팩토링하여, 대규모 인구 시뮬레이션 시의 속도를 비약적으로 향상시켰습니다.
  - `requirements.txt`에 `numpy` 의존성을 추가했습니다.

- **현실성 강화를 위한 시뮬레이션 로직 수정:**
  - **백신 정책:**
    - 돌파 감염 확률(`BREAKTHROUGH_RATE_MODIFIER`)을 낮추고, 백신 면역 감소율(`VACCINE_WANING_MODIFIER`)을 하향 조정하여 백신 효과를 강화했습니다.
    - 감염 경험이 있는 '회복자'가 백신을 더 적극적으로 접종하는 행동을 모델링했습니다 (`RECOVERED_VACCINATION_RATE_MODIFIER` 추가).
  - **'제로 코로나' 정책 (중국):**
    - 웹 검색 결과를 바탕으로, 비현실적인 '전국 즉시 봉쇄'에서 '소수 감염에 대한 초고속 대규모 지역 봉쇄' 방식으로 로직을 수정하여 현실성을 높였습니다.
  - **국내 항공 이동:**
    - 10세대마다 인구의 일부가 무작위로 위치를 바꾸는 '내부 이동' 기능을 추가했습니다.
    - 실제 데이터를 검색하여 국가별 `INTERNAL_TRAVEL_RATE`를 현실에 맞게 조정했습니다.
    - 방역 단계가 3단계 이상(국가별 설정에 따라 차등)으로 격상되면 항공 이동이 자동으로 금지되는 로직을 추가했습니다.
    - '격리' 또는 '사망' 상태의 인구는 이동에서 제외하도록 로직을 수정했습니다.
  - **초기 발병:** 바이러스가 특정 지역에 집중되어 시작하도록 수정했습니다.

- **사용자 경험(UX) 및 기능 개선:**
  - **고속 모드 (`--no-history`):** 세대별 시각화 기록을 저장하지 않아 메모리 사용량을 최소화하고 대규모 시뮬레이션 속도를 극대화하는 '고속 모드'를 추가했습니다.
  - **`run_fast.bat`:** 고속 모드 실행 후 결과 이미지를 자동으로 열어주는 배치 파일을 추가했습니다.
  - **안전한 조기 종료:** `Ctrl+C`를 통해 시뮬레이션을 중단해도, 해당 시점까지의 결과가 정상적으로 저장되고 그래프가 생성되도록 수정했습니다.
  - **GUI 개선:** 뉴스 로그가 길어질 경우 자동으로 줄바꿈되고, 화면을 가리지 않도록 수정했습니다. 불필요한 뉴스(항공 이동)는 제거했습니다.
  - **CLI 출력:** `run.bat` 등 CLI 환경에서 시뮬레이션 진행 상황을 알 수 있는 진행률 표시줄을 추가했습니다.

- **버그 수정:**
  - 기능 추가 과정에서 발생했던 다수의 `IndentationError` (들여쓰기 오류)를 해결했습니다.

---

# 전염병 확산 시뮬레이션: 개발 로그

**날짜:** 2025년 10월 26일
**개발자:** Gemini

이 문서는 2025년 10월 26일에 진행된 주요 기능 추가 및 코드 변경 사항을 기록하여, 후속 개발자가 프로젝트의 이력과 구조를 쉽게 파악할 수 있도록 돕기 위해 작성되었습니다.

---

## 1차 주요 업데이트

### 1. 사망(Deceased) 상태 및 의료 시스템 붕괴 모델
- **상세 설명:** `DECEASED` 상태 추가, `HOSPITAL_CAPACITY_THRESHOLD`, `BASE_DEATH_RATE`, `OVERWHELMED_DEATH_RATE_MULTIPLIER` 파라미터 도입.

### 2. 결과 저장 기능 (.png, .csv)
- **상세 설명:** 'Save Results' 버튼 추가, 클릭 시 통계 그래프와 데이터를 각각 `.png`, `.csv` 파일로 저장.

### 3. 배치 모드 (Batch Mode)
- **상세 설명:** `--batch` 커맨드라인 인수를 통해 GUI 없이 실행 및 자동 저장 기능 구현.

### 4. 핵심 결과 지표 (KPI) UI 표시
- **상세 설명:** 총사망자, 최대 감염자 수 등을 계산하여 결과 창에 텍스트로 표시.

### 5. 동적 이벤트 시스템 및 뉴스 바 (초기)
- **상세 설명:** `VACCINATION_START_THRESHOLD`에 따른 동적 백신 접종 시작 및 뉴스 알림 기능.

---

## 2차 주요 업데이트 (UI 및 시스템 아키텍처 개선)

### 6. 동적 '방역 대응 단계' 시스템
- **상세 설명:** 감염률에 따라 1~5단계로 자동 조절되는 방역 단계 시스템 도입. `ALERT_LEVELS` 파라미터 구조 추가.

### 7. 국가별 '대응 속도' 모델링
- **상세 설명:** `RESPONSE_DELAY` 파라미터를 도입하여 정책 발효까지의 시간차 시뮬레이션.

### 8. GUI 기반 시나리오 선택 시스템
- **상세 설명:** Tkinter 기반의 설정 창에서 `.json` 파일을 자동으로 감지하고 선택하는 기능 구현. 코드 아키텍처 리팩토링.

### 9. UI/UX 개선
- **상세 설명:** 누적 뉴스 기록, 타임라인 마커, 전체 UI 한글화.

---

## 3차 주요 업데이트 (시뮬레이션 고도화)

### 10. 동적 지역 봉쇄 시스템
- **상세 설명:** 특정 방역 단계 도달 시, 감염 밀집 지역(핫스팟)을 동적으로 찾아내 봉쇄하는 기능 추가. `REGIONAL_LOCKDOWN_*` 파라미터 도입.

### 11. 보수적인 방역 완화 정책 튜닝
- **상세 설명:** 모든 시나리오의 `threshold_down` 값을 하향 조정하여 방역 단계 완화 조건을 더 까다롭게 변경.

---

## 4차 주요 업데이트 (전략 모델링)

### 12. '제로 코로나' 방역 전략 모델링
- **상세 설명:** `LOCKDOWN_STRATEGY` 파라미터를 추가하여, `"ZERO_COVID"`, `"REGIONAL"`, `"NONE"` 중 하나의 방역 전략을 선택하는 기능 구현.

### 13. 국가별 시나리오 현실성 제고 (추가 자료 조사 기반)
- **상세 설명:** 각 국가의 코로나19 대응에 대한 추가적인 구글 검색 자료 조사를 바탕으로, 10개 국가 시나리오의 파라미터들을 더 현실에 가깝게 재조정.

---

## 5차 주요 업데이트 (최종 UI 개선 및 안정화)

### 14. 확산-치사율 연동 슬라이더 UI

- **상세 설명:** 바이러스의 확산률과 치사율이 반비례하는 현실을 반영하기 위해, 설정 창의 관련 UI를 연동되는 슬라이더로 변경했습니다.
    - **연동 로직:** `config.json`에 `TOTAL_VIRULENCE_POTENTIAL` 파라미터를 추가했습니다. 확산률 슬라이더와 치사율 슬라이더의 값의 합이 이 "바이러스 잠재력" 값을 넘지 않도록, 하나의 슬라이더를 움직이면 다른 슬라이더가 반대로 움직이는 시소 형태로 구현했습니다.
    - **사용자 경험:** 이를 통해 사용자는 바이러스의 특성을 더 직관적이고 현실적으로 설정할 수 있습니다.

### 15. 최종 실행 오류 수정

- **상세 설명:** 대규모 기능 추가 및 리팩토링 과정에서 발생했던 다수의 실행 오류를 해결했습니다.
    - **`NameError`, `IndentationError` 해결:** 코드 리팩토링 과정에서 발생한 변수 미정의 및 들여쓰기 오류를 수정했습니다.
    - **`TclError` (Tkinter 오류) 해결:** GUI 설정 창을 구성할 때, Tkinter의 `pack`과 `grid` 레이아웃 매니저를 혼용하여 발생했던 충돌을 해결하여 GUI가 정상적으로 렌더링되도록 수정했습니다.
- **최종 목표:** 이 수정들을 통해, 사용자가 보고했던 '실행 시 에러가 나고 꺼지는' 현상을 완전히 해결하고 프로그램의 최종 안정성을 확보했습니다.

---

## 코드 구조 변경 사항 요약

- **`sir_model.py`의 `main()` 함수:** '설정 GUI 단계' -> '데이터 전체 생성 단계' -> '시각화 및 탐색 단계'로 명확히 분리되었으며, `LOCKDOWN_STRATEGY`에 따라 다른 제어 흐름을 가집니다.
- **`config.json` 파라미터:** `LOCKDOWN_STRATEGY`, `TOTAL_VIRULENCE_POTENTIAL` 등이 새로 추가되었고, 각 국가 시나리오의 현실성을 높이기 위해 전반적인 파라미터 튜닝이 이루어졌습니다.

---

## 후속 개발자를 위한 제언

- **전략 확장:** 새로운 방역 전략을 추가하려면, `main()` 함수의 `while` 루프 내 `LOCKDOWN_STRATEGY` 분기점에 새로운 전략 로직을 추가하여 확장할 수 있습니다.
- **UI 커스터마이징:** UI 요소는 Tkinter(설정 창)와 Matplotlib의 `widgets`(결과 창)을 사용하여 구현되었습니다. UI 변경이 필요할 경우 각 라이브러리의 공식 문서를 참고하면 유용합니다.
- **시나리오 테스트:** 모든 시뮬레이션의 핵심 변수는 `.json` 설정 파일을 통해 제어됩니다. 새로운 시나리오를 테스트할 때는 기존의 `example_config_*.json` 파일을 복제하여 수정하는 방식을 권장합니다. 프로그램이 자동으로 파일을 인식합니다.